# IEC 61131-3 语言参考手册

## 数据类型

### 基本类型

| 类型 | 大小 | 范围 | 示例 |
|------|------|------|------|
| BOOL | 1 bit | TRUE/FALSE | `x : BOOL := TRUE;` |
| SINT | 8 bit | -128..127 | `s : SINT := -10;` |
| INT | 16 bit | -32768..32767 | `i : INT := 42;` |
| DINT | 32 bit | -2^31..2^31-1 | `d : DINT := 100000;` |
| LINT | 64 bit | -2^63..2^63-1 | `l : LINT := 0;` |
| USINT | 8 bit | 0..255 | `u : USINT := 200;` |
| UINT | 16 bit | 0..65535 | `u : UINT := 5000;` |
| UDINT | 32 bit | 0..2^32-1 | `u : UDINT := 0;` |
| ULINT | 64 bit | 0..2^64-1 | `u : ULINT := 0;` |
| REAL | 32 bit | IEEE 754 | `r : REAL := 3.14;` |
| LREAL | 64 bit | IEEE 754 | `r : LREAL := 3.14159;` |
| STRING | 可变 | 字符串 | `s : STRING := 'hello';` |
| WSTRING | 可变 | 宽字符串 | `s : WSTRING := "hello";` |
| TIME | 64 bit | 持续时间 | `t : TIME := T#100ms;` |
| DATE | 64 bit | 日期 | `d : DATE := D#2024-01-01;` |

### 位字符串类型

| 类型 | 大小 |
|------|------|
| BYTE | 8 bit |
| WORD | 16 bit |
| DWORD | 32 bit |
| LWORD | 64 bit |

## 程序组织单元 (POU)

### FUNCTION

```iec
FUNCTION Add : INT
VAR_INPUT
    a : INT;
    b : INT;
END_VAR
    Add := a + b;
END_FUNCTION
```

### FUNCTION_BLOCK

```iec
FUNCTION_BLOCK Counter
VAR_INPUT
    reset : BOOL;
END_VAR
VAR_OUTPUT
    count : INT;
END_VAR
VAR
    value : INT := 0;
END_VAR
    IF reset THEN
        value := 0;
    ELSE
        value := value + 1;
    END_IF;
    count := value;
END_FUNCTION_BLOCK
```

### PROGRAM

```iec
PROGRAM Main
VAR
    myCounter : Counter;
    result    : INT;
END_VAR
    myCounter(reset := FALSE);
    result := myCounter.count;
END_PROGRAM
```

## 控制结构

### IF/ELSIF/ELSE

```iec
IF condition THEN
    (* ... *)
ELSIF other_condition THEN
    (* ... *)
ELSE
    (* ... *)
END_IF;
```

### CASE

```iec
CASE selector OF
    1: action1;
    2, 3: action2;
    4..10: action3;
ELSE
    default_action;
END_CASE;
```

### FOR

```iec
FOR i := 0 TO 10 BY 2 DO
    (* body *)
END_FOR;
```

### WHILE

```iec
WHILE condition DO
    (* body *)
END_WHILE;
```

### REPEAT/UNTIL

```iec
REPEAT
    (* body *)
UNTIL condition
END_REPEAT;
```

## 运算符

| 运算符 | 说明 | 示例 |
|--------|------|------|
| `:=` | 赋值 | `x := 5;` |
| `+` `-` `*` `/` | 算术 | `x := a + b * c;` |
| `MOD` | 取模 | `x := a MOD b;` |
| `**` | 幂 | `x := a ** 2;` |
| `=` `<>` `<` `>` `<=` `>=` | 比较 | `IF a > b THEN` |
| `AND` `OR` `XOR` `NOT` | 逻辑 | `IF a AND b THEN` |

## 变量声明

| 类型 | 说明 |
|------|------|
| `VAR` | 局部变量 |
| `VAR_INPUT` | 输入参数 |
| `VAR_OUTPUT` | 输出参数 |
| `VAR_IN_OUT` | 双向参数 |
| `VAR_TEMP` | 临时变量 |
| `VAR_GLOBAL` | 全局变量 |
| `VAR RETAIN` | 掉电保持变量 |
| `VAR CONSTANT` | 常量 |

## Located 变量

```iec
VAR
    motor_on AT %QX0.0 : BOOL;    (* 输出位 *)
    sensor   AT %IX1.0 : BOOL;    (* 输入位 *)
    speed    AT %IW2   : INT;     (* 输入字 *)
    setpoint AT %MW10  : INT;     (* 内存字 *)
END_VAR
```

## 标准函数

### 数学函数
`ABS`, `SQRT`, `SIN`, `COS`, `TAN`, `ASIN`, `ACOS`, `ATAN`, `LN`, `LOG`, `EXP`

### 字符串函数
`LEN`, `LEFT`, `RIGHT`, `MID`, `FIND`, `INSERT`, `DELETE`, `REPLACE`, `CONCAT`

### 类型转换
`INT_TO_REAL`, `REAL_TO_INT`, `INT_TO_STRING`, `STRING_TO_INT`, `BOOL_TO_INT` ...

### 标准功能块
`TON` (延时接通), `TOF` (延时断开), `TP` (脉冲), `CTU` (递增计数器), `CTD` (递减计数器), `R_TRIG` (上升沿), `F_TRIG` (下降沿)
